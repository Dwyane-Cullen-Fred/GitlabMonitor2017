<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="file">

    <resultMap id="projectFileCount" type="org.bean.ProjectFileCount" >
        <result property="student" column="student" />
        <result property="line_count" column="count" />
    </resultMap>


    <select id="selectFile" resultMap="projectFileCount">
        <![CDATA[
            SELECT author_name as student, sum(add_line) as count from
            (SELECT * FROM commitv1, filev1
            WHERE commitv1.id = filev1.sha
            AND commitv1.projectid = #{project_id}
            AND filename like #{file_feather}
            AND add_line <= #{line_limit}
            GROUP BY filev1.sha) as a
            GROUP BY author_name
            ORDER BY student
        ]]>

    </select>
</mapper>